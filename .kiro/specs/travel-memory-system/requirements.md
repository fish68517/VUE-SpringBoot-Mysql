# 旅游规划与记忆系统 - 需求文档

## 介绍

旅游规划与记忆系统是一个全栈 Web 应用，旨在为用户提供一站式的旅游体验管理平台。系统集成旅游规划、记忆管理、多媒体记录、地图足迹和社交互动功能，解决旅游记忆碎片化问题，支持用户在规划、记录、回忆和分享的全周期中获得更好的体验。

## 术语表

- **系统（System）**: 旅游规划与记忆系统，包括前端 Vue.js 应用和后端 SpringBoot 服务
- **用户（User）**: 系统的注册用户，可以创建和管理旅游记录与计划
- **旅游记录（Travel Record）**: 用户对已完成旅游的记录，包含照片、视频、日记等多媒体内容
- **旅游计划（Travel Plan）**: 用户对即将进行的旅游的规划，包含目的地、时间、预算和每日行程
- **多媒体文件（Multimedia File）**: 用户上传的照片、视频等文件
- **地图足迹（Map Footprint）**: 用户在地图上标记的旅游地点和路线
- **行程项（Itinerary Item）**: 计划中的单个事项，如景点、住宿、交通等
- **社交互动（Social Interaction）**: 用户对公开记录的评论和点赞
- **权限（Permission）**: 记录的公开/私密设置，控制其他用户的访问权限
- **JWT 认证（JWT Authentication）**: 基于 JSON Web Token 的用户身份验证机制

## 需求

### 需求 1：用户管理与认证

**用户故事：** 作为新用户，我想要注册账户并登录系统，以便能够创建和管理我的旅游记录和计划。

#### 接受标准

1. WHEN 用户提交注册表单（邮箱、密码、用户名），THE 系统 SHALL 验证邮箱格式和密码强度，并在数据库中创建新用户账户
2. WHEN 用户提交登录凭证（邮箱和密码），THE 系统 SHALL 验证凭证正确性，并返回有效的 JWT 令牌用于后续请求
3. WHEN 用户已登录，THE 系统 SHALL 在每个受保护的 API 请求中验证 JWT 令牌的有效性
4. WHEN 用户访问个人资料页面，THE 系统 SHALL 显示用户的基本信息（用户名、邮箱、头像、个人简介）
5. WHEN 用户更新个人资料，THE 系统 SHALL 验证输入数据的有效性，并将更改持久化到数据库

### 需求 2：旅游记录管理

**用户故事：** 作为旅游爱好者，我想要创建和管理旅游记录，包括上传照片、视频和撰写日记，以便记录我的旅游经历。

#### 接受标准

1. WHEN 用户点击"创建新记录"按钮，THE 系统 SHALL 显示记录创建表单，包含名称、目的地、日期和描述字段
2. WHEN 用户提交记录表单，THE 系统 SHALL 在数据库中创建新的旅游记录，并返回记录 ID
3. WHEN 用户在记录编辑器中撰写日记，THE 系统 SHALL 使用富文本编辑器（Quill）支持格式化文本、图片嵌入和链接
4. WHEN 用户上传多媒体文件（照片或视频），THE 系统 SHALL 支持分片上传，并将文件存储在服务器上，记录文件路径和关联的记录 ID
5. WHEN 用户查看记录列表，THE 系统 SHALL 实现分页显示，每页显示 10 条记录，并支持按日期排序
6. WHEN 用户编辑已有的记录，THE 系统 SHALL 允许修改记录的所有字段，并验证用户是否为记录的拥有者
7. WHEN 用户删除记录，THE 系统 SHALL 删除记录及其关联的所有多媒体文件和评论

### 需求 3：地图足迹管理

**用户故事：** 作为旅游者，我想要在地图上标记我访问过的地点和路线，以便可视化我的旅游足迹。

#### 接受标准

1. WHEN 用户在地图足迹组件中点击地图，THE 系统 SHALL 显示地理编码对话框，允许用户输入地点名称或坐标
2. WHEN 用户确认地点信息，THE 系统 SHALL 将标记点（Marker）添加到地图上，并将坐标存储到数据库
3. WHEN 用户添加多个标记点，THE 系统 SHALL 支持绘制连接这些点的路线（Polyline）
4. WHEN 用户查看记录的地图足迹，THE 系统 SHALL 从数据库检索所有关联的标记点和路线，并在地图上显示
5. WHEN 用户删除标记点，THE 系统 SHALL 从地图和数据库中移除该标记点及其关联的路线段

### 需求 4：旅游计划管理

**用户故事：** 作为计划者，我想要创建和管理旅游计划，包括设定目的地、时间、预算和每日行程，以便有序地组织我的旅游。

#### 接受标准

1. WHEN 用户创建新计划，THE 系统 SHALL 显示计划创建表单，包含目的地、开始日期、结束日期、预算和描述字段
2. WHEN 用户提交计划表单，THE 系统 SHALL 在数据库中创建新的旅游计划，并返回计划 ID
3. WHEN 用户为计划添加每日行程项，THE 系统 SHALL 允许用户指定日期、事项类型（景点、住宿、交通）、名称和描述
4. WHEN 用户编辑行程项，THE 系统 SHALL 允许修改所有字段，并验证用户是否为计划的拥有者
5. WHEN 用户删除行程项，THE 系统 SHALL 从数据库中移除该行程项
6. WHEN 用户查看计划详情，THE 系统 SHALL 按日期顺序显示所有行程项，并计算总预算

### 需求 5：社交互动与权限管理

**用户故事：** 作为社交用户，我想要分享我的旅游记录，并与其他用户互动（评论、点赞），以便建立旅游社区。

#### 接受标准

1. WHEN 用户创建或编辑记录，THE 系统 SHALL 提供权限设置选项（公开或私密），默认为私密
2. WHEN 用户将记录设置为公开，THE 系统 SHALL 允许其他用户查看该记录
3. WHEN 其他用户查看公开记录，THE 系统 SHALL 显示评论区域和点赞按钮
4. WHEN 用户提交评论，THE 系统 SHALL 验证评论内容不为空，创建评论记录，并将其关联到目标记录
5. WHEN 用户点赞公开记录，THE 系统 SHALL 创建点赞记录，并更新记录的点赞计数
6. WHEN 用户取消点赞，THE 系统 SHALL 删除点赞记录，并更新点赞计数
7. WHEN 用户查看社交动态，THE 系统 SHALL 显示所有公开记录的列表，按创建时间倒序排列，并显示每条记录的点赞数和评论数

### 需求 6：数据持久化与数据库设计

**用户故事：** 作为系统管理员，我想要确保所有用户数据被正确存储和管理，以便系统的可靠性和数据完整性。

#### 接受标准

1. THE 系统 SHALL 使用 MySQL 数据库存储所有用户、记录、计划和社交数据
2. THE 系统 SHALL 定义以下表结构：users（用户）、travel_records（旅游记录）、multimedia_files（多媒体文件）、travel_plans（旅游计划）、itinerary_items（行程项）、map_footprints（地图足迹）、comments（评论）、likes（点赞）
3. THE 系统 SHALL 使用外键约束确保数据引用的完整性（例如 travel_records.user_id 引用 users.id）
4. THE 系统 SHALL 为频繁查询的字段（如 user_id、created_at）创建索引以优化查询性能
5. WHEN 执行涉及多个表的操作（如删除用户及其所有记录），THE 系统 SHALL 使用数据库事务确保操作的原子性

### 需求 7：文件上传与存储

**用户故事：** 作为内容创建者，我想要上传大型多媒体文件（照片和视频），以便记录我的旅游体验。

#### 接受标准

1. WHEN 用户选择多媒体文件进行上传，THE 系统 SHALL 支持分片上传机制，将大文件分割成多个块进行上传
2. WHEN 用户上传文件，THE 系统 SHALL 验证文件类型（仅允许图片和视频格式），并检查文件大小限制（单个文件最大 500MB）
3. WHEN 文件上传完成，THE 系统 SHALL 将文件存储在服务器文件系统中，并在数据库中记录文件路径、文件名和关联的记录 ID
4. WHEN 用户删除记录，THE 系统 SHALL 同时删除服务器上的关联多媒体文件
5. WHEN 用户查看记录，THE 系统 SHALL 从数据库检索文件路径，并在前端显示多媒体内容

### 需求 8：前端用户界面与交互

**用户故事：** 作为用户，我想要使用直观、响应式的用户界面，以便在不同设备上流畅地使用系统。

#### 接受标准

1. THE 系统 SHALL 使用 Vue.js 3 和 Element Plus 组件库构建前端应用，确保 UI 一致性和可用性
2. THE 系统 SHALL 实现响应式设计，支持桌面、平板和移动设备的显示
3. THE 系统 SHALL 使用 Vue Router 实现客户端路由，支持受保护的路由（需要用户登录）
4. THE 系统 SHALL 使用 Pinia 进行全局状态管理，存储用户信息、旅游数据等
5. THE 系统 SHALL 使用 Axios 库与后端 API 进行通信，并实现统一的错误处理和请求拦截

### 需求 9：后端 API 设计

**用户故事：** 作为前端开发者，我想要使用清晰、一致的 RESTful API，以便高效地与后端通信。

#### 接受标准

1. THE 系统 SHALL 提供以下 API 端点：
   - POST /api/auth/register - 用户注册
   - POST /api/auth/login - 用户登录
   - GET /api/users/{id} - 获取用户信息
   - PUT /api/users/{id} - 更新用户信息
   - POST /api/travels - 创建旅游记录
   - GET /api/travels - 获取用户的旅游记录列表
   - GET /api/travels/{id} - 获取单个旅游记录详情
   - PUT /api/travels/{id} - 更新旅游记录
   - DELETE /api/travels/{id} - 删除旅游记录
   - POST /api/files/upload - 上传多媒体文件
   - POST /api/plans - 创建旅游计划
   - GET /api/plans - 获取用户的旅游计划列表
   - POST /api/footprints - 添加地图足迹
   - POST /api/comments - 添加评论
   - POST /api/likes - 添加点赞
2. THE 系统 SHALL 为所有 API 响应使用统一的 JSON 格式，包含状态码、消息和数据字段
3. THE 系统 SHALL 在 API 请求中验证 JWT 令牌，并返回 401 Unauthorized 错误（如果令牌无效或过期）
4. THE 系统 SHALL 为所有 API 端点实现适当的 HTTP 状态码（200 成功、201 创建、400 请求错误、401 未授权、404 未找到、500 服务器错误）

### 需求 10：安全性与数据保护

**用户故事：** 作为用户，我想要确保我的个人数据和隐私得到保护，以便安心使用系统。

#### 接受标准

1. THE 系统 SHALL 使用 bcrypt 算法对用户密码进行哈希处理，不存储明文密码
2. THE 系统 SHALL 使用 JWT 令牌进行用户认证，令牌有效期为 24 小时
3. THE 系统 SHALL 在所有受保护的 API 端点中验证用户权限，确保用户只能访问和修改自己的数据
4. THE 系统 SHALL 对用户输入进行验证和清理，防止 SQL 注入和 XSS 攻击
5. THE 系统 SHALL 使用 HTTPS 加密传输所有敏感数据（如密码、令牌）
