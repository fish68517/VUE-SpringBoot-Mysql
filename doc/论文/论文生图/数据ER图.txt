// Shark Fitness 健身社区数据库 ER 图 (完整版)
// 直接粘贴到 https://dbdiagram.io 即可渲染

Table user {
  id bigint [pk, increment] // 用户ID
  username varchar(50) [unique, not null]
  password varchar(100) [not null]
  role varchar(20) [not null, note: 'user/coach/admin']
  avatar varchar(255)
  gender varchar(10) [note: 'male/female']
  intro varchar(500)
  created_at datetime [default: `CURRENT_TIMESTAMP`]
  updated_at datetime [default: `CURRENT_TIMESTAMP`, note: 'ON UPDATE CURRENT_TIMESTAMP']

  Indexes {
    (username) [name: 'username']
    (role)
    (created_at)
  }
}

Table check_in {
  id bigint [pk, increment] // 打卡ID
  user_id bigint [not null, ref: > user.id] 
  check_date date [not null]
  check_time datetime [default: `CURRENT_TIMESTAMP`]

  Indexes {
    (user_id, check_date) [unique]
    (user_id)
    (check_date)
  }
}

Table coach_student {
  id bigint [pk, increment]
  coach_id bigint [not null, ref: > user.id]
  student_id bigint [not null, ref: > user.id]
  created_at datetime [default: `CURRENT_TIMESTAMP`]

  Indexes {
    (coach_id, student_id) [unique]
    (coach_id)
    (student_id)
  }
}

Table fitness_resource {
  id bigint [pk, increment]
  title varchar(200) [not null]
  description varchar(1000)
  content_type varchar(50) [not null, note: 'video/article/document']
  file_url varchar(500)
  content longtext
  creator_id bigint [ref: > user.id]
  view_count int [default: 0]
  created_at datetime [default: `CURRENT_TIMESTAMP`]
  updated_at datetime [default: `CURRENT_TIMESTAMP`, note: 'ON UPDATE CURRENT_TIMESTAMP']

  Indexes {
    (content_type)
    (creator_id)
    (created_at)
    (view_count)
  }
}

Table collection {
  id bigint [pk, increment]
  user_id bigint [not null, ref: > user.id]
  resource_id bigint [not null, ref: > fitness_resource.id]
  created_at datetime [default: `CURRENT_TIMESTAMP`]

  Indexes {
    (user_id, resource_id) [unique]
    (user_id)
    (resource_id)
  }
}

Table dynamic {
  id bigint [pk, increment]
  content longtext [not null]
  image_urls varchar(1000)
  user_id bigint [not null, ref: > user.id]
  like_count int [default: 0]
  comment_count int [default: 0]
  status varchar(20) [default: 'approved', note: 'pending/approved/rejected']
  created_at datetime [default: `CURRENT_TIMESTAMP`]
  updated_at datetime [default: `CURRENT_TIMESTAMP`, note: 'ON UPDATE CURRENT_TIMESTAMP']

  Indexes {
    (user_id)
    (status)
    (created_at)
    (like_count)
  }
}

Table comment {
  id bigint [pk, increment]
  content longtext [not null]
  user_id bigint [not null, ref: > user.id]
  dynamic_id bigint [not null, ref: > dynamic.id]
  created_at datetime [default: `CURRENT_TIMESTAMP`]

  Indexes {
    (user_id)
    (dynamic_id)
    (created_at)
  }
}

Table like_record {
  id bigint [pk, increment]
  user_id bigint [not null, ref: > user.id]
  dynamic_id bigint [not null, ref: > dynamic.id]
  created_at datetime [default: `CURRENT_TIMESTAMP`]

  Indexes {
    (user_id, dynamic_id) [unique]
    (user_id)
    (dynamic_id)
  }
}

Table diet_record {
  id bigint [pk, increment]
  user_id bigint [not null, ref: > user.id]
  meal_type varchar(20) [note: 'breakfast/lunch/dinner/snack']
  food_items varchar(500)
  calories int
  meal_date date
  created_at datetime [default: `CURRENT_TIMESTAMP`]
  updated_at datetime [default: `CURRENT_TIMESTAMP`, note: 'ON UPDATE CURRENT_TIMESTAMP']

  Indexes {
    (user_id)
    (meal_date)
    (created_at)
  }
}

Table training_plan {
  id bigint [pk, increment]
  name varchar(200) [not null]
  description varchar(1000)
  exercises longtext [note: 'JSON格式']
  coach_id bigint [not null, ref: > user.id]
  student_id bigint [not null, ref: > user.id]
  start_date date
  end_date date
  status varchar(20) [default: 'active', note: 'active/completed/cancelled']
  created_at datetime [default: `CURRENT_TIMESTAMP`]
  updated_at datetime [default: `CURRENT_TIMESTAMP`, note: 'ON UPDATE CURRENT_TIMESTAMP']

  Indexes {
    (coach_id)
    (student_id)
    (status)
    (created_at)
  }
}

