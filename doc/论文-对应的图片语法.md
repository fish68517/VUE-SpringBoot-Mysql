### 数据库ER 图

erDiagram
    DEPARTMENTS ||--o{ USERS : "belongs to"
    ROLES ||--o{ USERS : "has"
    USERS ||--o{ INBOUND_ORDERS : "creates"
    USERS ||--o{ TRANSACTION_LOGS : "performs"
    PRODUCTS ||--o{ INVENTORY : "has batches"
    INBOUND_ORDERS ||--o{ INVENTORY : "contains"
    INVENTORY ||--o{ TRANSACTION_LOGS : "generates"

    DEPARTMENTS {
        int id PK
        varchar name UK
        timestamp created_at
        timestamp updated_at
    }
    ROLES {
        int id PK
        varchar role_name UK
    }
    USERS {
        int id PK
        varchar username UK
        varchar password_hash
        varchar full_name
        int role_id FK
        int department_id FK
        boolean is_active
        timestamp created_at
        timestamp updated_at
    }
    PRODUCTS {
        int id PK
        varchar sku UK
        varchar name
        text description
        timestamp created_at
        timestamp updated_at
    }
    INBOUND_ORDERS {
        int id PK
        varchar order_number UK
        int created_by_user_id FK
        enum status
        text notes
        timestamp created_at
        timestamp updated_at
    }
    INVENTORY {
        int id PK
        int product_id FK
        varchar batch_code UK
        int inbound_order_id FK
        int quantity
        datetime received_at
        timestamp created_at
        timestamp updated_at
    }
    TRANSACTION_LOGS {
        bigint id PK
        int inventory_id FK
        int user_id FK
        enum type
        int quantity_change
        int quantity_after_transaction
        varchar notes
        timestamp created_at
    }
	
	### 系统架构图
	graph TD
    subgraph 用户层
        A1[仓库管理员<br>Web 浏览器] -->|HTTPS| B1
        A2[仓库操作员<br>Android 手机] -->|HTTPS| B2
    end

    subgraph 表示层
        B1[Web 前端<br>Vue.js / HTML+JS] 
        B2[Android App<br>Kotlin + XML]
    end

    subgraph 业务逻辑层
        C[Spring Boot 后端<br>RESTful API + JWT]
    end

    subgraph 数据持久层
        D[MySQL 数据库<br>InnoDB]
        D1[departments<br>roles<br>users]
        D2[products<br>inbound_orders<br>inventory<br>transaction_logs]
    end

    subgraph 基础设施层
        E1[Tomcat 服务器]
        E2[文件系统<br>二维码 PNG]
        E3[网络 HTTPS]
    end

    B1 -->|API 调用| C
    B2 -->|API 调用| C
    C -->|JPA/Hibernate| D
    C -->|生成/读取| E2
    C --> E1
    D --> E1

    style A1 fill:#e1f5fe
    style A2 fill:#e8f5e8
    style C fill:#fff3e0
    style D fill:#f3e5f5
	
	
	### 扫码入库时序图
	sequenceDiagram
    participant U as 操作员
    participant A as Android App
    participant S as Spring Boot API
    participant DB as MySQL 数据库

    U->>A: 打开扫码入库界面
    A->>A: 调用摄像头扫描二维码
    A->>A: 解析 batch_code
    A->>S: POST /inventory/scan {batch_code}
    S->>DB: SELECT * FROM inventory WHERE batch_code = ?
    DB-->>S: 返回产品、当前数量
    S-->>A: 返回商品详情
    A->>U: 弹出确认浮层（名称、批次、数量）
    U->>A: 点击“确认入库”，输入数量 n
    A->>S: POST /inbound {batch_code, quantity: n}
    S->>S: @Transactional 开启事务
    S->>DB: UPDATE inventory SET quantity = quantity + n, received_at = NOW() WHERE id = ?
    S->>DB: INSERT INTO transaction_logs (inventory_id, user_id, type, quantity_change, quantity_after) VALUES (...)
    DB-->>S: 事务提交成功
    S-->>A: {success: true, message: "入库成功"}
    A->>U: Toast 提示“入库成功，剩余: XX”